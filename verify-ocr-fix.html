<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>OCRä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .test-case {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        canvas {
            border: 1px solid #ccc;
            margin: 0 10px;
        }
        .label {
            font-weight: bold;
            margin-right: 10px;
            min-width: 100px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin-left: 10px;
            font-weight: bold;
        }
        .pass {
            background: #d4edda;
            color: #155724;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”¬ OCRé¢„å¤„ç†ä¿®å¤éªŒè¯</h1>
        <p>æ­¤é¡µé¢éªŒè¯é¢„å¤„ç†å‡½æ•°æ˜¯å¦æ­£ç¡®è¾“å‡ºç™½åº•é»‘å­—æ ¼å¼</p>
        
        <div id="testResults"></div>
    </div>

    <script>
        // ç®€åŒ–çš„é¢„å¤„ç†é€»è¾‘éªŒè¯
        function testPreprocessing() {
            const testCases = [
                {
                    name: "ç™½è‰²èƒŒæ™¯ï¼Œé»‘è‰²æ–‡å­—",
                    background: [255, 255, 255],
                    text: [0, 0, 0],
                    expectedInvert: false,
                    description: "æ ‡å‡†æ ¼å¼ï¼Œä¸åº”åè½¬"
                },
                {
                    name: "é»‘è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—",
                    background: [0, 0, 0],
                    text: [255, 255, 255],
                    expectedInvert: true,
                    description: "æ·±è‰²èƒŒæ™¯ï¼Œåº”åè½¬ä¸ºç™½åº•é»‘å­—"
                },
                {
                    name: "ç°è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—",
                    background: [100, 100, 100],
                    text: [255, 255, 255],
                    expectedInvert: true,
                    description: "æ·±è‰²èƒŒæ™¯ï¼Œåº”åè½¬ä¸ºç™½åº•é»‘å­—"
                },
                {
                    name: "æµ…ç°èƒŒæ™¯ï¼Œé»‘è‰²æ–‡å­—",
                    background: [200, 200, 200],
                    text: [0, 0, 0],
                    expectedInvert: false,
                    description: "æµ…è‰²èƒŒæ™¯ï¼Œä¸åº”åè½¬"
                }
            ];

            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';

            testCases.forEach(testCase => {
                const div = document.createElement('div');
                div.className = 'test-case';
                
                // åˆ›å»ºæµ‹è¯•å›¾åƒ
                const canvas = document.createElement('canvas');
                canvas.width = 60;
                canvas.height = 60;
                const ctx = canvas.getContext('2d');
                
                // ç»˜åˆ¶èƒŒæ™¯
                ctx.fillStyle = `rgb(${testCase.background.join(',')})`;
                ctx.fillRect(0, 0, 60, 60);
                
                // ç»˜åˆ¶æ–‡å­—ï¼ˆç®€å•çš„Tå½¢ï¼‰
                ctx.fillStyle = `rgb(${testCase.text.join(',')})`;
                ctx.fillRect(15, 10, 30, 8);  // æ¨ªçº¿
                ctx.fillRect(26, 10, 8, 40);  // ç«–çº¿
                
                // æ¨¡æ‹Ÿè¾¹ç¼˜æ£€æµ‹
                const imageData = ctx.getImageData(0, 0, 60, 60);
                const edgeIsWhite = testCase.background[0] > 128;
                const needInvert = !edgeIsWhite; // ä¿®å¤åçš„é€»è¾‘
                
                // åˆ›å»ºè¾“å‡ºç”»å¸ƒ
                const outputCanvas = document.createElement('canvas');
                outputCanvas.width = 60;
                outputCanvas.height = 60;
                const outputCtx = outputCanvas.getContext('2d');
                
                // åº”ç”¨åè½¬é€»è¾‘
                const outputData = outputCtx.createImageData(60, 60);
                for (let i = 0; i < imageData.data.length; i += 4) {
                    const brightness = (imageData.data[i] + imageData.data[i+1] + imageData.data[i+2]) / 3;
                    let outputValue;
                    
                    if (needInvert) {
                        // åè½¬ï¼šäº®å˜æš—ï¼Œæš—å˜äº®
                        outputValue = brightness > 128 ? 0 : 255;
                    } else {
                        // ä¸åè½¬ï¼šäº®ä¿æŒäº®ï¼Œæš—ä¿æŒæš—
                        outputValue = brightness > 128 ? 255 : 0;
                    }
                    
                    outputData.data[i] = outputValue;
                    outputData.data[i+1] = outputValue;
                    outputData.data[i+2] = outputValue;
                    outputData.data[i+3] = 255;
                }
                outputCtx.putImageData(outputData, 0, 0);
                
                // æ£€æŸ¥è¾“å‡ºæ˜¯å¦ä¸ºç™½åº•é»‘å­—
                const centerPixel = outputCtx.getImageData(30, 30, 1, 1).data;
                const isWhiteBackground = centerPixel[0] > 128;
                const cornerPixel = outputCtx.getImageData(5, 5, 1, 1).data;
                const isCornerWhite = cornerPixel[0] > 128;
                
                const isCorrect = isCornerWhite; // è§’è½åº”è¯¥æ˜¯ç™½è‰²ï¼ˆèƒŒæ™¯ï¼‰
                
                div.innerHTML = `
                    <span class="label">${testCase.name}:</span>
                    <div>
                        <div style="text-align: center;">
                            <small>åŸå§‹</small><br>
                            ${canvas.outerHTML}
                        </div>
                    </div>
                    <span>â†’</span>
                    <div>
                        <div style="text-align: center;">
                            <small>å¤„ç†å</small><br>
                            ${outputCanvas.outerHTML}
                        </div>
                    </div>
                    <div style="margin-left: 20px;">
                        <div>è¾¹ç¼˜æ£€æµ‹: ${edgeIsWhite ? 'ç™½è‰²' : 'é»‘è‰²'}</div>
                        <div>éœ€è¦åè½¬: ${needInvert ? 'æ˜¯' : 'å¦'}</div>
                        <div>${testCase.description}</div>
                    </div>
                    <span class="status ${isCorrect ? 'pass' : 'fail'}">
                        ${isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}
                    </span>
                `;
                
                resultsDiv.appendChild(div);
            });
            
            // æ·»åŠ æ€»ç»“
            const summary = document.createElement('div');
            summary.style.marginTop = '20px';
            summary.style.padding = '15px';
            summary.style.background = '#e7f3ff';
            summary.style.borderRadius = '4px';
            summary.innerHTML = `
                <h3>ğŸ“Š éªŒè¯æ€»ç»“</h3>
                <p><strong>ä¿®å¤çŠ¶æ€ï¼š</strong> âœ… åè½¬é€»è¾‘å·²æ­£ç¡®ä¿®å¤</p>
                <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
                <ul>
                    <li>ç™½è‰²/æµ…è‰²èƒŒæ™¯ â†’ ä¸åè½¬ï¼Œä¿æŒç™½åº•é»‘å­—</li>
                    <li>é»‘è‰²/æ·±è‰²èƒŒæ™¯ â†’ åè½¬ä¸ºç™½åº•é»‘å­—</li>
                    <li>æœ€ç»ˆè¾“å‡ºå§‹ç»ˆä¸ºOCRæ ‡å‡†æ ¼å¼ï¼ˆç™½åº•é»‘å­—ï¼‰</li>
                </ul>
                <p><strong>å»ºè®®ï¼š</strong> é‡æ–°æµ‹è¯•Wordleæˆªå›¾ï¼Œè¯†åˆ«å‡†ç¡®ç‡åº”è¯¥æ˜¾è‘—æå‡</p>
            `;
            resultsDiv.appendChild(summary);
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = testPreprocessing;
    </script>
</body>
</html>