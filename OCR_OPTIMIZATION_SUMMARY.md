# Tesseract.js OCR 优化总结

## 已实施的优化策略

### 1. 图像尺寸优化
**问题**: Tesseract.js 对图像DPI敏感，小尺寸图像识别效果差
**解决方案**: 
- 自动计算缩放系数（2x-4x），确保图像尺寸适合OCR
- 使用`imageSmoothingEnabled = false`保持锐利边缘
- 目标DPI范围：150-300 DPI

### 2. OCR引擎和模式优化
**第一次尝试 (主要方法)**:
- PSM模式：`8` (PSM_SINGLE_WORD) - 比SINGLE_CHAR更准确
- OCR引擎：`1` (仅LSTM) - 现代神经网络引擎
- 字符白名单：仅A-Z大写字母
- 字符黑名单：排除数字和符号

**第二次尝试 (回退方法)**:
- PSM模式：`13` (PSM_RAW_LINE) - 原始文本行处理
- OCR引擎：`2` (传统+LSTM混合) - 兼容性更好
- 更宽松的置信度参数

**第三次尝试 (最后回退)**:
- PSM模式：`10` (PSM_SINGLE_CHAR) - 专门处理单字符
- OCR引擎：`0` (仅传统引擎) - 对某些情况效果更好
- 极低的置信度阈值

### 3. 高级参数调优
```javascript
// 文本检测参数
textord_min_linesize: '2.5',           // 适合单字母的最小行高
edges_max_children_per_outline: '40',  // 增加边缘检测精度

// 字符分类参数
classify_min_certainty: '0',           // 降低置信度阈值
classify_max_certainty_margin: '5.5',  // 增大置信度边距

// 线段检测参数
textord_heavy_nr: '1',                 // 启用重线段检测(对I、T有帮助)

// 质量控制参数
tessedit_reject_bad_qual_wds: '0',     // 不拒绝低质量词汇
tessedit_preserve_blk_wd_gaps: '0',    // 不保留块词间隙
```

### 4. 图像预处理增强

#### 第一阶段：Otsu自适应阈值
- 使用Otsu算法自动找到最佳二值化阈值
- 根据配色方案微调阈值
- 自动判断深色/浅色背景

#### 第二阶段：高级图像增强 (enhanceContrastForOCR)
1. **自适应局部阈值处理**
   - 基于局部窗口统计的动态阈值
   - 自适应窗口大小
   - 使用均值和标准差计算阈值

2. **形态学闭运算**
   - 膨胀操作：连接断开的笔画
   - 腐蚀操作：恢复字母形状
   - 特别有助于细笔画字母(I、T、L等)

3. **噪声消除**
   - 连通组件分析
   - 泛洪填充算法识别独立区域
   - 自动移除过小的噪点区域

### 5. 多层回退策略
```
主要识别(PSM_SINGLE_WORD + LSTM) 
    ↓ (置信度 < 50)
增强预处理 + PSM_RAW_LINE + 混合引擎
    ↓ (置信度 < 40)
PSM_SINGLE_CHAR + 传统引擎
    ↓
选择最佳结果
```

### 6. 调试信息增强
- 详细的OCR参数记录
- 缩放信息和优化提示
- 多次尝试的结果比较
- 自动识别潜在问题和建议

## 预期效果

1. **识别准确率提升**: 通过多层回退和参数优化，显著提高单字母识别准确率
2. **鲁棒性增强**: 适应各种Wordle网站的颜色方案和字体样式
3. **细节保留**: 形态学处理确保细笔画字母不会丢失
4. **噪声抗性**: 自动去除背景噪声和小的干扰区域

## 使用建议

1. 测试时注意观察调试信息中的OCR优化提示
2. 如果某个字母经常识别错误，查看预处理阶段的图像质量
3. 置信度低于30的结果需要人工验证
4. 对于特殊字体或颜色方案，可能需要进一步调优参数

## 技术细节

- 图像处理基于Canvas 2D API
- OCR使用Tesseract.js 2.x版本
- 支持Chrome扩展环境
- 兼容各种Wordle变体网站